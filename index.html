<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Blackjack</title>
<style>
  :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
  body { margin: 0; background: #0b132b; color: #fff; display: flex; min-height: 100vh; }
  .app { margin: auto; width: min(720px, 100%); padding: 16px; box-sizing: border-box; }
  .table { background: #1c2541; border-radius: 16px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.4); }
  .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; justify-content: center; }
  .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
  h1 { font-size: clamp(20px, 5vw, 28px); margin: 0 0 8px; letter-spacing: .5px; }
  .bank { background: #3a506b; padding: 8px 12px; border-radius: 999px; font-weight: 600; }
  .status { text-align: center; min-height: 24px; margin: 8px 0 4px; font-weight: 600; }
  .hand { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; min-height: 120px; }
  .label { opacity: .9; font-size: 14px; text-align: center; margin-bottom: 6px; }
  button { padding: 12px 16px; border-radius: 10px; border: none; background: #5bc0be; color: #031926; font-weight: 700; letter-spacing:.3px; }
  button:disabled { opacity: .5; }
  .btn-outline { background: transparent; color: #fff; outline: 2px solid #fff3; }
  .controls { gap: 10px; justify-content: center; margin-top: 8px; }
  .bet { background: #0f4c5c; border-radius: 12px; padding: 10px; display: flex; align-items: center; gap: 8px; }
  input[type="number"] { width: 90px; padding: 8px; border-radius: 8px; border: none; }
  .settings { display: grid; grid-template-columns: repeat(2, minmax(120px,1fr)); gap: 8px; margin: 10px 0 0; }
  select { padding: 8px; border-radius: 8px; border: none; }
  .card { width: 64px; height: 94px; border-radius: 8px; background: linear-gradient(145deg, #fff, #f1f1f1); color: #111; display: grid; place-items: center; font-weight: 800; position: relative; box-shadow: 0 2px 8px rgba(0,0,0,.35); }
  .card .small { position: absolute; top: 6px; left: 8px; font-size: 12px; }
  .card .big { font-size: 22px; }
  .card .suit { position: absolute; bottom: 6px; right: 8px; font-size: 12px; }
  .card.red { color: #c1121f; }
  .card.back { background: repeating-linear-gradient(45deg, #19376d, #19376d 8px, #0b2447 8px, #0b2447 16px); color: #fff; }
  .flex { display: flex; justify-content: space-between; align-items: center; }
  .footer { text-align: center; opacity: .8; font-size: 12px; margin-top: 10px; }
</style>
</head>
<body>
<div class="app">
  <div class="table">
    <div class="header">
      <h1>â™  Blackjack</h1>
      <div class="bank">Bank: $<span id="bank">1000</span></div>
    </div>

    <div class="row">
      <div class="bet">
        <label for="betAmount">Bet</label>
        <input id="betAmount" type="number" min="1" step="1" value="25" />
        <button id="dealBtn">Deal</button>
        <button id="resetBankBtn" class="btn-outline">Reset Bank</button>
      </div>
    </div>

    <div class="settings">
      <label>Decks
        <select id="numDecks">
          <option value="1">1</option>
          <option value="4">4</option>
          <option value="6" selected>6</option>
          <option value="8">8</option>
        </select>
      </label>
      <label>Dealer hits soft 17?
        <select id="hitSoft17">
          <option value="true">Yes</option>
          <option value="false" selected>No</option>
        </select>
      </label>
    </div>

    <div class="label" style="margin-top:10px;">Dealer</div>
    <div id="dealerHand" class="hand"></div>
    <div class="label">You</div>
    <div id="playerHand" class="hand"></div>

    <div class="status" id="status"></div>

    <div class="row controls">
      <button id="hitBtn" disabled>Hit</button>
      <button id="standBtn" disabled>Stand</button>
      <button id="doubleBtn" disabled>Double</button>
      <button id="newRoundBtn" class="btn-outline" disabled>New Round</button>
    </div>

    <div class="footer">Pro tip: Aces can be 1 or 11. Blackjack pays 3:2.</div>
  </div>
</div>

<script>
(function(){
  const bankEl = document.getElementById('bank');
  const betEl = document.getElementById('betAmount');
  const dealerEl = document.getElementById('dealerHand');
  const playerEl = document.getElementById('playerHand');
  const statusEl = document.getElementById('status');

  const dealBtn = document.getElementById('dealBtn');
  const hitBtn = document.getElementById('hitBtn');
  const standBtn = document.getElementById('standBtn');
  const doubleBtn = document.getElementById('doubleBtn');
  const newRoundBtn = document.getElementById('newRoundBtn');
  const resetBankBtn = document.getElementById('resetBankBtn');

  const numDecksEl = document.getElementById('numDecks');
  const hitSoft17El = document.getElementById('hitSoft17');

  // State
  let shoe = [];
  let bank = 1000;
  let bet = 25;
  let dealer = [];
  let player = [];
  let inRound = false;
  let playerStands = false;
  let hideHole = true;
  let blackjackPayout = 1.5; // 3:2
  let doubled = false;

  // Helpers
  const suits = ['â™ ','â™¥','â™¦','â™£'];
  const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];

  function cardValue(rank){
    if(rank === 'A') return 11;
    if(['J','Q','K'].includes(rank)) return 10;
    return parseInt(rank,10);
  }

  function handValue(cards){
    let total = 0, aces = 0;
    for(const c of cards){
      total += cardValue(c.rank);
      if(c.rank === 'A') aces++;
    }
    // Downgrade Aces from 11 to 1 as needed
    while(total > 21 && aces > 0){
      total -= 10;
      aces--;
    }
    return total;
  }

  function isBlackjack(cards){
    return cards.length === 2 && handValue(cards) === 21;
  }

  function newShoe(decks){
    const s = [];
    for(let d=0; d<decks; d++){
      for(const suit of suits){
        for(const rank of ranks){
          s.push({rank, suit});
        }
      }
    }
    // Shuffle (Fisherâ€“Yates)
    for(let i=s.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [s[i], s[j]] = [s[j], s[i]];
    }
    return s;
  }

  function draw(){
    if(shoe.length === 0) shoe = newShoe(parseInt(numDecksEl.value,10));
    return shoe.pop();
  }

  function renderHand(el, cards, hideFirst=false){
    el.innerHTML = '';
    cards.forEach((c, i)=>{
      const div = document.createElement('div');
      div.className = 'card' + ((c.suit === 'â™¥' || c.suit === 'â™¦') ? ' red' : '');
      if(hideFirst && i===1){
        div.className = 'card back';
        div.innerHTML = 'ðŸ‚ ';
      }else{
        const rank = c.rank;
        const suit = c.suit;
        div.innerHTML = `<span class="small">${rank}</span><span class="big">${rank}</span><span class="suit">${suit}</span>`;
      }
      el.appendChild(div);
    });
  }

  function setStatus(msg){ statusEl.textContent = msg; }
  function updateBank(){ bankEl.textContent = bank; }

  function resetHands(){
    dealer = [];
    player = [];
    playerStands = false;
    hideHole = true;
    doubled = false;
  }

  function resetUIRound(active){
    hitBtn.disabled = !active;
    standBtn.disabled = !active;
    doubleBtn.disabled = !active;
    newRoundBtn.disabled = active;
    dealBtn.disabled = active;
    betEl.disabled = active;
    numDecksEl.disabled = active;
    hitSoft17El.disabled = active;
    resetBankBtn.disabled = active;
  }

  function startRound(){
    bet = Math.max(1, Math.floor(Number(betEl.value) || 1));
    if(bet > bank){
      setStatus("Bet exceeds bank.");
      return;
    }
    inRound = true;
    resetUIRound(true);
    resetHands();

    // Take bet up front
    bank -= bet;
    updateBank();

    // Initial deal
    player.push(draw(), draw());
    dealer.push(draw(), draw());
    render();

    // Check blackjack scenarios
    if(isBlackjack(player) || isBlackjack(dealer)){
      endRound(true);
      return;
    }

    setStatus("Your move: Hit, Stand, or Double.");
  }

  function dealerPlay(){
    hideHole = false;
    render();
    const hitSoft = (hitSoft17El.value === 'true');
    while(true){
      const v = handValue(dealer);
      const soft = isSoft(dealer);
      if(v < 17) { dealer.push(draw()); continue; }
      if(v === 17 && soft && hitSoft) { dealer.push(draw()); continue; }
      break;
    }
  }

  function isSoft(cards){
    // Soft = Ace counted as 11
    let total = 0, aces = 0;
    for(const c of cards){ total += cardValue(c.rank); if(c.rank==='A') aces++; }
    while(total > 21 && aces>0){ total -= 10; aces--; }
    return aces>0 && total<=21;
  }

  function endRound(naturalCheck=false){
    // Reveal dealer's hole card
    hideHole = false;

    if(naturalCheck){
      const pBJ = isBlackjack(player);
      const dBJ = isBlackjack(dealer);
      if(pBJ && dBJ){
        // Push, return bet
        bank += bet;
        setStatus("Push. Both have Blackjack.");
      } else if(pBJ){
        // Pay 3:2
        const win = bet + Math.floor(bet * blackjackPayout) + bet; // stake already removed, return stake + win
        bank += win;
        setStatus("Blackjack! You win 3:2.");
      } else if(dBJ){
        setStatus("Dealer has Blackjack. You lose.");
      }
      updateBank();
      inRound = false;
      resetUIRound(false);
      render();
      return;
    }

    // If player busted earlier, resolve now
    const pVal = handValue(player);
    if(pVal > 21){
      setStatus("Bust. You lose.");
      inRound = false;
      resetUIRound(false);
      render();
      return;
    }

    // Dealer plays then compare
    dealerPlay();

    const dVal = handValue(dealer);
    if(dVal > 21){
      // dealer busts, you win
      const payout = doubled ? bet*4 : bet*2; // stake + win; stake removed once; if doubled, original bet doubled already
      bank += payout;
      setStatus("Dealer busts. You win!");
    } else if(pVal > dVal){
      const payout = doubled ? bet*4 : bet*2;
      bank += payout;
      setStatus("You win!");
    } else if(pVal < dVal){
      setStatus("Dealer wins.");
    } else {
      // Push: return stake(s)
      const refund = doubled ? bet*2 : bet;
      bank += refund;
      setStatus("Push.");
    }

    updateBank();
    inRound = false;
    resetUIRound(false);
    render();
  }

  function render(){
    renderHand(playerEl, player, false);
    renderHand(dealerEl, dealer, hideHole);
  }

  // Actions
  hitBtn.addEventListener('click', ()=>{
    if(!inRound) return;
    player.push(draw());
    render();
    const v = handValue(player);
    if(v > 21){
      setStatus("Bust. You lose.");
      inRound = false;
      resetUIRound(false);
    } else {
      setStatus("Hit again or Stand.");
    }
  });

  standBtn.addEventListener('click', ()=>{
    if(!inRound) return;
    playerStands = true;
    endRound(false);
  });

  doubleBtn.addEventListener('click', ()=>{
    if(!inRound) return;
    if(player.length !== 2){
      setStatus("You can only double on your first move.");
      return;
    }
    if(bank < bet){
      setStatus("Not enough bank to double.");
      return;
    }
    // Take an additional bet equal to original
    bank -= bet;
    updateBank();
    doubled = true;
    // One card only, then stand
    player.push(draw());
    render();
    const v = handValue(player);
    if(v > 21){
      setStatus("Bust after double. You lose.");
      inRound = false;
      resetUIRound(false);
    } else {
      endRound(false);
    }
  });

  dealBtn.addEventListener('click', startRound);
  newRoundBtn.addEventListener('click', ()=>{
    if(inRound) return;
    resetHands();
    setStatus("");
    render();
    resetUIRound(false);
  });

  resetBankBtn.addEventListener('click', ()=>{
    if(inRound) return;
    bank = 1000;
    updateBank();
    setStatus("Bank reset to $1000.");
  });

  // Init
  updateBank();
  shoe = newShoe(parseInt(numDecksEl.value,10));
  render();
  setStatus("Place your bet and tap Deal.");
  resetUIRound(false);
})();
</script>
</body>
</html>
